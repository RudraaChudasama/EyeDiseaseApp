<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VisionCare Pro - AI Eye Diagnosis</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      height: 100%;
      padding: 20px;
    }

    html {
      height: 100%;
    }

    .status-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 12px 20px;
      text-align: center;
      font-weight: 600;
      z-index: 10000;
      display: none;
    }

    .status-banner.show {
      display: block;
    }

    .status-banner.success {
      background: #48bb78;
      color: white;
    }

    .status-banner.error {
      background: #f56565;
      color: white;
    }

    .status-banner.info {
      background: #4299e1;
      color: white;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    /* Navigation */
    nav {
      background: white;
      border-radius: 15px;
      padding: 20px 30px;
      margin-bottom: 30px;
      margin-top: 60px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      position: relative;
      z-index: 10;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-text {
      font-size: 22px;
      font-weight: 700;
      color: #667eea;
    }

    .nav-links {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .nav-btn {
      background: none;
      border: none;
      color: #4a5568;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      position: relative;
      z-index: 20;
    }

    .nav-btn:hover {
      background: #667eea;
      color: white;
    }

    .nav-btn.active {
      background: #667eea;
      color: white;
    }

    .dark-mode-toggle {
      background: #f7fafc;
      border: 2px solid #cbd5e0;
      color: #4a5568;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .dark-mode-toggle:hover {
      background: #2d3748;
      color: white;
      border-color: #2d3748;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    }

    body.dark-mode .card {
      background: #2d3748;
      color: #e2e8f0;
    }

    body.dark-mode nav {
      background: #2d3748;
      color: #e2e8f0;
    }

    body.dark-mode .logo-text {
      color: #9f7aea;
    }

    body.dark-mode .nav-btn {
      color: #e2e8f0;
    }

    body.dark-mode .nav-btn:hover {
      background: #9f7aea;
    }

    body.dark-mode .nav-btn.active {
      background: #9f7aea;
    }

    body.dark-mode .upload-area {
      background: #1a202c;
      border-color: #4a5568;
    }

    body.dark-mode .result-box,
    body.dark-mode .care-box,
    body.dark-mode .history-item,
    body.dark-mode .step-card,
    body.dark-mode .stat-card,
    body.dark-mode .chart-card,
    body.dark-mode .alerts-section,
    body.dark-mode .table-section {
      background: #1a202c;
    }

    body.dark-mode h1,
    body.dark-mode h2,
    body.dark-mode h3 {
      color: #e2e8f0;
    }

    body.dark-mode .result-label,
    body.dark-mode .upload-text,
    body.dark-mode .step-card p {
      color: #cbd5e0;
    }

    body.dark-mode .data-table thead {
      background: #2d3748;
    }

    body.dark-mode .data-table tbody tr:hover {
      background: #2d3748;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      color: white;
      font-size: 48px;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #e0e7ff;
      font-size: 18px;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      margin-bottom: 30px;
      position: relative;
      z-index: 1;
    }

    .upload-area {
      border: 3px dashed #cbd5e0;
      border-radius: 15px;
      padding: 60px 20px;
      text-align: center;
      cursor: pointer;
      background: #f7fafc;
      transition: all 0.3s;
      position: relative;
      z-index: 5;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #edf2f7;
    }

    .upload-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .upload-text {
      color: #4a5568;
      font-size: 18px;
      margin-bottom: 10px;
    }

    #fileInput {
      display: none;
    }

    .btn {
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin: 10px;
      position: relative;
      z-index: 10;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-success:hover {
      background: #38a169;
    }

    .btn-secondary {
      background: #ed8936;
      color: white;
    }

    .btn-secondary:hover {
      background: #dd6b20;
    }

    .btn-info {
      background: #4299e1;
      color: white;
    }

    .btn-info:hover {
      background: #3182ce;
    }

    .btn:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .btn-center {
      text-align: center;
      margin-top: 20px;
    }

    .preview-img {
      max-width: 100%;
      max-height: 400px;
      border-radius: 15px;
      margin: 20px auto;
      display: block;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .loading {
      text-align: center;
      padding: 40px;
    }

    .spinner {
      border: 4px solid #e2e8f0;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .result-box {
      background: #f7fafc;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
    }

    .result-item {
      margin-bottom: 25px;
    }

    .result-label {
      color: #4a5568;
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .result-value {
      color: #2d3748;
      font-size: 24px;
      font-weight: 700;
    }

    .confidence-bar {
      background: #e2e8f0;
      height: 30px;
      border-radius: 15px;
      overflow: hidden;
      margin-top: 10px;
    }

    .confidence-fill {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      transition: width 0.5s;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 15px;
      color: white;
      font-weight: 600;
    }

    .care-box {
      background: #edf2f7;
      border-left: 4px solid #667eea;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }

    .care-box h3 {
      color: #2d3748;
      font-size: 18px;
      margin-bottom: 15px;
    }

    .care-box ul {
      margin: 0;
      padding-left: 20px;
      color: #4a5568;
    }

    .care-box li {
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .action-btns {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #718096;
    }

    .modal h3 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .share-btns {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .share-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .share-whatsapp {
      background: #25d366;
      color: white;
    }

    .share-email {
      background: #ea4335;
      color: white;
    }

    .share-copy {
      background: #718096;
      color: white;
    }

    .history-item {
      background: #f7fafc;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .history-disease {
      color: #2d3748;
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 5px;
    }

    .history-meta {
      color: #718096;
      font-size: 14px;
    }

    .history-score {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
    }

    .export-history-btn {
      margin-top: 20px;
      width: 100%;
    }

    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-top: 30px;
    }

    .team-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      color: white;
    }



    .team-card h3 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .team-card .role {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .team-card .bio {
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.95;
    }

    .steps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      margin-top: 30px;
    }

    .step-card {
      background: #f7fafc;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
    }

    .step-number {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      margin: 0 auto 20px;
    }

    .step-card h3 {
      color: #2d3748;
      margin-bottom: 10px;
    }

    .step-card p {
      color: #4a5568;
      font-size: 14px;
      line-height: 1.6;
    }

    .doctor-finder {
      background: #f7fafc;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
    }

    .doctor-finder h3 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 20px;
    }

    .search-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .doctor-search-btn {
      padding: 15px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .admin-password-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .admin-password-overlay.active {
      display: flex;
    }

    .admin-password-box {
      background: white;
      border-radius: 20px;
      padding: 50px 40px;
      max-width: 450px;
      width: 90%;
      text-align: center;
    }

    .admin-password-title {
      color: #2d3748;
      font-size: 28px;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .admin-password-subtitle {
      color: #718096;
      font-size: 14px;
      margin-bottom: 30px;
    }

    .admin-password-input {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }

    .admin-password-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .admin-password-error {
      background: #fed7d7;
      color: #c53030;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .admin-password-error.show {
      display: block;
    }

    .admin-password-btns {
      display: flex;
      gap: 10px;
    }

    .admin-password-btns button {
      flex: 1;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .stat-info h3 {
      color: #718096;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .stat-info .stat-value {
      color: #2d3748;
      font-size: 32px;
      font-weight: 700;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 30px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .chart-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .chart-card h3 {
      color: #2d3748;
      font-size: 20px;
      margin-bottom: 20px;
      font-weight: 700;
    }

    .chart-container {
      width: 100%;
      height: 300px;
      position: relative;
    }

    .chart-legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 5px;
    }

    .legend-text {
      color: #4a5568;
      font-size: 14px;
    }

    .legend-value {
      color: #2d3748;
      font-weight: 600;
      margin-left: auto;
    }

    .table-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .table-header h3 {
      color: #2d3748;
      font-size: 20px;
      font-weight: 700;
    }

    .table-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .search-input {
      padding: 10px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      min-width: 250px;
    }

    .search-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .filter-select {
      padding: 10px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      background: white;
    }

    .export-btn {
      background: #48bb78;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .export-btn:hover {
      background: #38a169;
      transform: translateY(-2px);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .data-table thead {
      background: #f7fafc;
    }

    .data-table th {
      padding: 15px;
      text-align: left;
      color: #4a5568;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      border-bottom: 2px solid #e2e8f0;
    }

    .data-table td {
      padding: 15px;
      color: #2d3748;
      border-bottom: 1px solid #e2e8f0;
    }

    .data-table tbody tr {
      transition: all 0.2s;
      cursor: pointer;
    }

    .data-table tbody tr:hover {
      background: #f7fafc;
    }

    .disease-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 13px;
      font-weight: 600;
    }

    .disease-normal {
      background: #c6f6d5;
      color: #22543d;
    }

    .disease-cataract {
      background: #fed7d7;
      color: #742a2a;
    }

    .disease-conjunctivitis {
      background: #feebc8;
      color: #7c2d12;
    }

    .disease-eyelid {
      background: #e9d8fd;
      color: #44337a;
    }

    .disease-uveitis {
      background: #fbb6ce;
      color: #702459;
    }

    .confidence-badge {
      padding: 5px 12px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 13px;
    }

    .confidence-high {
      background: #c6f6d5;
      color: #22543d;
    }

    .confidence-medium {
      background: #feebc8;
      color: #7c2d12;
    }

    .confidence-low {
      background: #fed7d7;
      color: #742a2a;
    }

    .delete-btn {
      background: #fc8181;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      background: #f56565;
      transform: scale(1.05);
    }

    .delete-btn:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }

    .no-data {
      text-align: center;
      padding: 60px 20px;
      color: #a0aec0;
      font-size: 16px;
    }

    .hidden {
      display: none !important;
    }

    .disclaimer {
      text-align: center;
      color: #e0e7ff;
      font-size: 14px;
      margin-top: 30px;
      padding: 20px;
    }

    .backend-status {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .status-indicator.connected {
      background: #c6f6d5;
      color: #22543d;
    }

    .status-indicator.disconnected {
      background: #fed7d7;
      color: #742a2a;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status-dot.green {
      background: #48bb78;
    }

    .status-dot.red {
      background: #f56565;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .config-section {
      background: #f7fafc;
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
    }

    .config-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .config-item:last-child {
      border-bottom: none;
    }

    .config-label {
      color: #4a5568;
      font-weight: 600;
    }

    .config-value {
      color: #2d3748;
      font-family: monospace;
      background: white;
      padding: 4px 8px;
      border-radius: 5px;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 32px;
      }

      .card {
        padding: 25px;
      }

      .history-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .nav-links {
        width: 100%;
        justify-content: center;
      }

      nav {
        margin-top: 70px;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }

      .table-section {
        overflow-x: auto;
      }

      .data-table {
        min-width: 800px;
      }
    }
  </style>
  <style>
    @view-transition {
      navigation: auto;
    }
  </style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>

<body>
  <div class="status-banner" id="statusBanner"></div>
  <div class="container">
    <nav>
      <div class="logo-container"><img src="logo.png" alt="VisionCare Pro Logo"
          style="width: 50px; height: 50px; object-fit: contain; margin-right: 10px;">
        <div class="logo-text">
          VisionCare Pro
        </div>
      </div>
      <div class="nav-links"><button class="nav-btn active" onclick="showPage('home')">Home</button> <button
          class="nav-btn" onclick="showPage('howItWorks')">How It Works</button> <button class="nav-btn"
          onclick="showPage('about')">About Us</button> <button class="nav-btn" onclick="showAdminPage()">Admin</button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()"> <span id="darkModeText">Dark Mode</span> </button>
      </div>
    </nav><!-- HOME PAGE -->
    <div class="page active" id="home">
      <div class="page-header">
        <h1 id="mainTitle">Eye Disease Detection</h1>
        <p class="subtitle" id="subtitle">Advanced AI-powered detection using YOLO deep learning model</p>
      </div>
      <div class="card">
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
          <div class="upload-icon">
            <svg width="64" height="64" viewbox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          </div>
          <p class="upload-text">Click here to upload eye image</p>
          <p style="color: #a0aec0; font-size: 14px;">Supports PNG, JPG, JPEG</p>
        </div><input type="file" id="fileInput" accept="image/png, image/jpeg, image/jpg">
        <div class="btn-center"><button class="btn btn-primary"
            onclick="document.getElementById('fileInput').click()">Select Image</button>
        </div>
      </div>
      <div class="card hidden" id="previewCard"><img id="previewImg" class="preview-img" alt="Eye image">
        <div id="loading" class="loading hidden">
          <div class="spinner"></div>
          <p style="color: #4a5568;">Analyzing image with YOLO model...</p>
        </div>
        <div id="results" class="hidden">
          <div class="result-box">
            <div class="result-item">
              <div class="result-label">
                Detected Condition
              </div>
              <div class="result-value" id="diseaseResult">
                -
              </div>
            </div>
            <div class="result-item">
              <div class="result-label">
                Confidence Score
              </div>
              <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceFill" style="width: 0%;">
                  0%
                </div>
              </div>
            </div>
            <div class="care-box">
              <h3>üí° Care Recommendations</h3>
              <ul id="careList"></ul>
            </div>
            <div class="action-btns"><button class="btn btn-secondary" onclick="showDoctorFinder()">üîç Find
                Doctor</button> <button class="btn btn-info" onclick="showShareModal()">Share Report</button> <button
                class="btn btn-primary" onclick="downloadReport()">üì• Download Report </button> <button
                class="btn btn-success" onclick="newScan()">üîÑ New Scan</button>
            </div>
            <div class="doctor-finder hidden" id="doctorFinder">
              <h3>üè• Find Eye Specialists Near You</h3>
              <div class="search-grid"><button class="doctor-search-btn btn-primary"
                  onclick="searchDoctor('general Eye Doctor')"> üë®‚Äç‚öïÔ∏è General Eye Doctor </button> <button
                  class="doctor-search-btn btn-secondary" onclick="searchDoctor('ophthalmologist')"> üëì Ophthalmologist
                </button> <button class="doctor-search-btn btn-info" onclick="searchDoctor('retina specialist')"> üëÅÔ∏è
                  Retina Specialist </button> <button class="doctor-search-btn btn-success"
                  onclick="searchDoctor('cataract surgeon')"> ‚öïÔ∏è Cataract Surgeon </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="disclaimer" id="disclaimerText">
        ‚ö†Ô∏è This is an AI-assisted tool. Always consult a qualified healthcare professional for proper diagnosis and
        treatment.
      </div>
    </div><!-- HOW IT WORKS PAGE -->
    <div class="page" id="howItWorks">
      <div class="card">
        <div class="page-header">
          <h2 style="color: #2d3748; font-size: 36px; margin-bottom: 15px;">How Our Detection System Works</h2>
          <p style="color: #4a5568; font-size: 18px; line-height: 1.8;">Our advanced AI-powered system uses YOLO (You
            Only Look Once) deep learning technology to detect eye diseases with high accuracy.</p>
        </div>
        <div class="steps-grid">
          <div class="step-card">
            <div class="step-number">
              1
            </div>
            <h3>Upload Image</h3>
            <p>Upload a clear photo of the eye using your device camera or existing image file.</p>
          </div>
          <div class="step-card">
            <div class="step-number">
              2
            </div>
            <h3>AI Analysis</h3>
            <p>Our YOLO model analyzes the image using trained neural networks to detect patterns and abnormalities.</p>
          </div>
          <div class="step-card">
            <div class="step-number">
              3
            </div>
            <h3>Get Results</h3>
            <p>Receive instant detection results with confidence scores and detailed information about the condition.
            </p>
          </div>
          <div class="step-card">
            <div class="step-number">
              4
            </div>
            <h3>Take Action</h3>
            <p>Follow care recommendations, find nearby specialists, and download your detection report.</p>
          </div>
        </div>
        <div style="margin-top: 40px; padding: 30px; background: #f7fafc; border-radius: 15px;">
          <h3 style="color: #2d3748; margin-bottom: 15px;">Detectable Conditions</h3>
          <ul style="color: #4a5568; line-height: 2;">
            <li><strong>Normal</strong> - Healthy eye with no detected abnormalities</li>
            <li><strong>Cataract</strong> - Clouding of the eye's natural lens</li>
            <li><strong>Conjunctivitis</strong> - Inflammation of the conjunctiva (pink eye)</li>
            <li><strong>Eyelid</strong> - Conditions affecting the eyelid structure</li>
            <li><strong>Uveitis</strong> - Inflammation of the uvea (middle layer of the eye)</li>
          </ul>
        </div>
      </div>
    </div><!-- ABOUT US PAGE -->
    <div class="page" id="about">
      <div class="card">
        <div class="page-header">
          <h2 style="color: #2d3748; font-size: 36px; margin-bottom: 15px;">About Our Team</h2>
          <p style="color: #4a5568; font-size: 18px; line-height: 1.8;">We are ICT Engineering students passionate about
            leveraging AI technology to make healthcare more accessible and efficient.</p>
        </div>
        <div class="team-grid">
          <div class="team-card"><img src="rudra image.jpg" alt="Rudra Chudasama"
              style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; display: block;">
            <h3>Rudra Chudasama</h3>
            <p class="role">ICT Engineering Student</p>
            <p class="bio">Specializing in AI-powered medical diagnostics and computer vision. Passionate about
              developing innovative solutions that bridge technology and healthcare.</p>
            <p style="margin-top: 15px; font-weight: 600;">üìû Contact: 9327233815</p>
          </div>
          <div class="team-card"><img src="aman image.jpg" alt="Aman Prajapati"
              style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; display: block;">
            <h3>Aman Prajapati</h3>
            <p class="role">ICT Engineering Student</p>
            <p class="bio">Focused on machine learning applications in medical imaging. Dedicated to creating accessible
              healthcare tools that empower patients and professionals.</p>
            <p style="margin-top: 15px; font-weight: 600;">üìû Contact: 6354041047</p>
          </div>
        </div>
        <div style="margin-top: 40px; padding: 30px; background: #f7fafc; border-radius: 15px; text-align: center;">
          <h3 style="color: #2d3748; margin-bottom: 15px;">Our Mission</h3>
          <p style="color: #4a5568; line-height: 1.8; font-size: 16px;">To democratize access to early eye disease
            detection using artificial intelligence, helping people around the world receive timely diagnoses and
            connect with appropriate medical care.</p>
        </div>
      </div>
    </div><!-- ADMIN PAGE -->
    <div class="page" id="admin">
      <div class="page-header">
        <h1 style="color: white; font-size: 42px; margin-bottom: 10px;">üìä Admin Dashboard</h1>
        <p class="subtitle">Healthcare Analytics &amp; Management</p>
      </div><!-- Backend Status Card -->
      <div class="backend-status">
        <h3 style="color: #2d3748; margin-bottom: 15px; font-size: 18px;">Backend Connection</h3>
        <div class="status-indicator" id="backendStatus">
          <div class="status-dot red" id="statusDot"></div>
          <div><strong id="statusText">Checking connection...</strong>
            <div style="font-size: 13px; margin-top: 5px;" id="statusDetails"></div>
          </div>
        </div>
        <div class="config-section">
          <div class="config-item"><span class="config-label">API Endpoint:</span> <span class="config-value"
              id="apiEndpoint">Not Set</span>
          </div>
          <div class="config-item"><span class="config-label">Total Records:</span> <span class="config-value"
              id="recordCount">0</span>
          </div>
          <div class="config-item"><span class="config-label">Last Sync:</span> <span class="config-value"
              id="lastSync">Never</span>
          </div>
        </div>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-info">
            <h3>Total Scans</h3>
            <div class="stat-value" id="adminTotalScans">
              0
            </div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-info">
            <h3>Today's Scans</h3>
            <div class="stat-value" id="adminTodayScans">
              0
            </div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-info">
            <h3>Avg Confidence</h3>
            <div class="stat-value" id="adminAvgConfidence">
              0%
            </div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-info">
            <h3>High Risk Cases</h3>
            <div class="stat-value" id="adminHighRiskCases">
              0
            </div>
          </div>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card">
          <h3>üìä Disease Distribution</h3>
          <div class="chart-container">
            <canvas id="adminDiseaseChart"></canvas>
          </div>
          <div class="chart-legend" id="adminDiseaseLegend"></div>
        </div>
      </div>
      <div class="card" style="margin-bottom: 30px;">
        <h2 style="color: #2d3748; margin-bottom: 25px;">üìã Detection History</h2>
        <div id="historyList"></div><button class="btn btn-primary export-history-btn" onclick="exportHistoryPDF()"> üìÑ
          Export History </button>
      </div>
      <div class="table-section">
        <div class="table-header">
          <h3>üìã All Detection Records</h3>
          <div class="table-controls"><input type="text" class="search-input" id="adminSearchInput"
              placeholder="üîç Search by image name or disease..." oninput="adminFilterTable()"> <select
              class="filter-select" id="adminDiseaseFilter" onchange="adminFilterTable()">
              <option value="all">All Diseases</option>
              <option value="Normal">Normal</option>
              <option value="Cataract">Cataract</option>
              <option value="Conjunctivitis">Conjunctivitis</option>
              <option value="Eyelid">Eyelid</option>
              <option value="Uveitis">Uveitis</option>
            </select> <button class="export-btn" onclick="adminExportAllData()">üì• Export CSV</button>
          </div>
        </div>
        <div id="adminTableContainer">
          <table class="data-table">
            <thead>
              <tr>
                <th>Date &amp; Time</th>
                <th>Image Name</th>
                <th>Disease Detected</th>
                <th>Confidence</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="adminTableBody">
              <tr>
                <td colspan="5" class="no-data">Loading data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div><!-- Admin Password Modal -->
  <div class="admin-password-overlay" id="adminPasswordOverlay">
    <div class="admin-password-box">
      <h1 class="admin-password-title">Admin Access</h1>
      <p class="admin-password-subtitle">Enter password to access dashboard</p>
      <div class="admin-password-error" id="adminPasswordError">
        Invalid password. Please try again.
      </div>
      <form id="adminPasswordForm" onsubmit="handleAdminLogin(event)"><input type="password"
          class="admin-password-input" id="adminPasswordInput" placeholder="Enter admin password" required>
        <div class="admin-password-btns"><button type="button" class="btn btn-secondary"
            onclick="closeAdminPassword()">Cancel</button> <button type="submit" class="btn btn-primary">Login</button>
        </div>
      </form>
    </div>
  </div><!-- Share Modal -->
  <div class="modal" id="shareModal">
    <div class="modal-content"><button class="modal-close" onclick="closeShareModal()">√ó</button>
      <h3>üì§ Share Your Report</h3>
      <div class="share-btns"><button class="share-btn share-whatsapp" onclick="shareWhatsApp()"> <span
            style="font-size: 24px;">üì±</span> Share via WhatsApp </button> <button class="share-btn share-email"
          onclick="shareEmail()"> <span style="font-size: 24px;">üìß</span> Share via Email </button> <button
          class="share-btn share-copy" onclick="copyReportText()"> <span style="font-size: 24px;">üìã</span> Copy Report
          Text </button>
      </div>
    </div>
  </div><!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content"><button class="modal-close" onclick="closeDeleteModal()">√ó</button>
      <div style="text-align: center; font-size: 64px; margin-bottom: 20px;">
        üóëÔ∏è
      </div>
      <h3>Delete Record?</h3>
      <p style="color: #718096; margin-bottom: 30px; line-height: 1.6;">Are you sure you want to delete this detection
        record? This action cannot be undone.</p>
      <div style="display: flex; gap: 15px; justify-content: center;"><button class="btn btn-secondary"
          onclick="closeDeleteModal()">Cancel</button> <button class="btn" style="background: #fc8181; color: white;"
          onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
  <script>
    // ====== CONFIGURATION - CHANGE THESE ======
    const BACKEND_CONFIG = {
      API_URL: 'http://localhost:5000',  // Your Flask backend URL
      DETECT_ENDPOINT: '/detect',         // Detection endpoint
      SAVE_ENDPOINT: '/save',            // Save record endpoint
      GET_ALL_ENDPOINT: '/records',      // Get all records endpoint
      DELETE_ENDPOINT: '/delete',        // Delete record endpoint
      TIMEOUT: 5000                      // Request timeout in ms
    };

    const ADMIN_PASSWORD = 'admin123';

    const careDatabase = {
      'normal': [
        'Maintain regular eye check-ups every 1-2 years',
        'Practice the 20-20-20 rule for screen time',
        'Wear UV-protective sunglasses outdoors',
        'Eat a balanced diet rich in vitamins A, C, and E'
      ],
      'cataract': [
        'Schedule urgent appointment with ophthalmologist',
        'Protect eyes from UV rays with quality sunglasses',
        'Maintain blood sugar control if diabetic',
        'Consider surgical options for treatment'
      ],
      'conjunctivitis': [
        'Consult doctor for proper diagnosis',
        'Apply warm compresses several times daily',
        'Wash hands frequently',
        'Do not share towels or cosmetics'
      ],
      'eyelid': [
        'Schedule eye examination with ophthalmologist',
        'Keep eyelid area clean and avoid rubbing',
        'Apply warm compresses if swelling occurs',
        'Avoid sharing eye makeup or face towels',
        'Monitor for any changes in vision or pain'
      ],
      'uveitis': [
        'üö® URGENT: See eye doctor immediately',
        'Use prescribed anti-inflammatory eye drops',
        'Wear sunglasses to reduce light sensitivity',
        'Take all medications as directed',
        'Regular follow-up appointments are essential'
      ]
    };

    const diseaseColors = {
      'Normal': '#48bb78',
      'Cataract': '#f56565',
      'Conjunctivitis': '#ed8936',
      'Eyelid': '#9f7aea',
      'Uveitis': '#ed64a6'
    };

    const highRiskDiseases = ['Cataract', 'Uveitis'];

    const defaultConfig = {
      background_color: '#667eea',
      surface_color: '#ffffff',
      text_color: '#2d3748',
      primary_action_color: '#667eea',
      secondary_action_color: '#48bb78',
      font_family: 'Segoe UI',
      font_size: 16,
      main_title: 'Eye Disease Detection',
      subtitle: 'Advanced AI-powered detection using YOLO deep learning model',
      disclaimer_text: '‚ö†Ô∏è This is an AI-assisted tool. Always consult a qualified healthcare professional for proper diagnosis and treatment.'
    };

    let detectionHistory = [];
    let currentDetection = null;
    let isDarkMode = false;
    let isAdminAuthenticated = false;
    let adminFilteredRecords = [];
    let recordToDelete = null;
    let backendConnected = false;

    // ====== BACKEND API FUNCTIONS ======
    async function checkBackendConnection() {
      try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 5000);

        const response = await fetch(`${BACKEND_CONFIG.API_URL}/health`, {
          signal: controller.signal
        });
        clearTimeout(timeout);

        backendConnected = response.ok;
        updateBackendStatus(backendConnected);

        if (backendConnected) {
          console.log('‚úÖ Backend connected, loading records...');
          await loadAllRecords();
        }
      } catch (error) {
        console.error('‚ùå Backend connection failed:', error);
        backendConnected = false;
        updateBackendStatus(false, error.message);
      }
    }

    function updateBackendStatus(connected, errorMsg = '') {
      const statusEl = document.getElementById('backendStatus');
      const dotEl = document.getElementById('statusDot');
      const textEl = document.getElementById('statusText');
      const detailsEl = document.getElementById('statusDetails');

      if (connected) {
        statusEl.className = 'status-indicator connected';
        dotEl.className = 'status-dot green';
        textEl.textContent = '‚úÖ Backend Connected';
        detailsEl.textContent = 'All data will be saved to your backend server';
      } else {
        statusEl.className = 'status-indicator disconnected';
        dotEl.className = 'status-dot red';
        textEl.textContent = '‚ùå Backend Disconnected';
        detailsEl.textContent = errorMsg || 'Make sure your Flask server is running on ' + BACKEND_CONFIG.API_URL;
      }

      document.getElementById('apiEndpoint').textContent = BACKEND_CONFIG.API_URL;
      document.getElementById('lastSync').textContent = new Date().toLocaleTimeString();
    }

    async function detectWithBackend(imageData, fileName) {
      if (!backendConnected) {
        showBanner('Backend not connected. Using demo mode.', 'error');
        simulateDetection(fileName);
        return;
      }

      try {
        console.log('üì§ Sending image to backend for detection...');
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 30000);

        const response = await fetch(`${BACKEND_CONFIG.API_URL}${BACKEND_CONFIG.DETECT_ENDPOINT}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ image: imageData }),
          signal: controller.signal
        });

        clearTimeout(timeout);

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const result = await response.json();
        console.log('‚úÖ Detection result:', result);

        if (result.success) {
          // If backend returned an annotated image (data URI), show it in preview
          if (result.annotated_image) {
            try {
              document.getElementById('previewImg').src = result.annotated_image;
            } catch (e) {
              console.warn('Could not set annotated image on preview:', e);
            }
          }
          // preserve existing behavior (show disease + confidence, save record, etc.)
          displayResults(result.disease, result.confidence, fileName);
        } else {
          throw new Error(result.error || 'Detection failed');
        }
      } catch (error) {
        console.error('‚ùå Detection error:', error);
        showBanner('Detection failed: ' + error.message, 'error');
        document.getElementById('loading').classList.add('hidden');
      }
    }

    async function saveRecordToBackend(record) {
      if (!backendConnected) {
        console.warn('Backend not connected, record not saved');
        return false;
      }

      try {
        const response = await fetch(`${BACKEND_CONFIG.API_URL}${BACKEND_CONFIG.SAVE_ENDPOINT}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(record)
        });

        if (!response.ok) {
          throw new Error(`Save failed: ${response.status}`);
        }

        const result = await response.json();

        if (result.success) {
          showBanner('‚úÖ Record saved successfully!', 'success');
          await loadAllRecords();
          return true;
        } else {
          throw new Error(result.error || 'Save failed');
        }
      } catch (error) {
        console.error('Save error:', error);
        showBanner('Failed to save: ' + error.message, 'error');
        return false;
      }
    }

    async function loadAllRecords() {
      if (!backendConnected) {
        console.log('‚ö†Ô∏è Cannot load records - backend not connected');
        return;
      }

      try {
        console.log('üì• Loading all records from backend...');
        const response = await fetch(`${BACKEND_CONFIG.API_URL}${BACKEND_CONFIG.GET_ALL_ENDPOINT}`);

        if (!response.ok) {
          throw new Error(`Load failed: ${response.status}`);
        }

        const result = await response.json();
        console.log('üì¶ Received records:', result);

        if (result.success) {
          detectionHistory = result.records || [];
          console.log('‚úÖ Loaded', detectionHistory.length, 'records');
          document.getElementById('recordCount').textContent = detectionHistory.length;
          renderHistory();

          // Always update admin dashboard data when records are loaded
          console.log('üîÑ Refreshing admin dashboard data...');
          updateAdminDashboard(detectionHistory);
        }
      } catch (error) {
        console.error('‚ùå Load error:', error);
      }
    }

    async function deleteRecordFromBackend(recordId) {
      if (!backendConnected) {
        showBanner('Backend not connected', 'error');
        return false;
      }

      try {
        const response = await fetch(`${BACKEND_CONFIG.API_URL}${BACKEND_CONFIG.DELETE_ENDPOINT}/${recordId}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          throw new Error(`Delete failed: ${response.status}`);
        }

        const result = await response.json();

        if (result.success) {
          showBanner('‚úÖ Record deleted successfully!', 'success');
          await loadAllRecords();
          return true;
        } else {
          throw new Error(result.error || 'Delete failed');
        }
      } catch (error) {
        console.error('Delete error:', error);
        showBanner('Failed to delete: ' + error.message, 'error');
        return false;
      }
    }

    // ====== UI FUNCTIONS ======
    function showBanner(message, type) {
      const banner = document.getElementById('statusBanner');
      banner.textContent = message;
      banner.className = `status-banner show ${type}`;

      setTimeout(() => {
        banner.classList.remove('show');
      }, 4000);
    }

    function showPage(pageName) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageName).classList.add('active');
    }

    function showAdminPage() {
      document.getElementById('adminPasswordOverlay').classList.add('active');
    }

    function handleAdminLogin(event) {
      event.preventDefault();
      const password = document.getElementById('adminPasswordInput').value;

      if (password === ADMIN_PASSWORD) {
        document.getElementById('adminPasswordOverlay').classList.remove('active');
        document.getElementById('adminPasswordError').classList.remove('show');
        document.getElementById('adminPasswordInput').value = '';

        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.getElementById('admin').classList.add('active');

        console.log('Admin logged in, loading dashboard with records:', detectionHistory.length);
        updateAdminDashboard(detectionHistory);
        showBanner('Admin login successful', 'success');
      } else {
        document.getElementById('adminPasswordError').classList.add('show');
        document.getElementById('adminPasswordInput').value = '';
      }
    }

    function closeAdminPassword() {
      document.getElementById('adminPasswordOverlay').classList.remove('active');
      document.getElementById('adminPasswordInput').value = '';
      document.getElementById('adminPasswordError').classList.remove('show');
    }

    function toggleDarkMode() {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode');
      document.getElementById('darkModeText').textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
    }

    // ====== FILE UPLOAD ======
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.match('image/(png|jpeg|jpg)')) {
        showBanner('Please upload a PNG or JPEG image', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = function (event) {
        document.getElementById('previewImg').src = event.target.result;
        document.getElementById('previewCard').classList.remove('hidden');
        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('results').classList.add('hidden');

        if (backendConnected) {
          detectWithBackend(event.target.result, file.name);
        } else {
          simulateDetection(file.name);
        }
      };
      reader.readAsDataURL(file);
    });

    function simulateDetection(fileName) {
      setTimeout(() => {
        const diseases = [
          { name: 'Normal', confidence: 95 },
          { name: 'Cataract', confidence: 87 },
          { name: 'Conjunctivitis', confidence: 89 },
          { name: 'Eyelid', confidence: 82 },
          { name: 'Uveitis', confidence: 84 }
        ];

        const random = diseases[Math.floor(Math.random() * diseases.length)];
        displayResults(random.name, random.confidence, fileName);
      }, 2500);
    }

    async function displayResults(disease, confidence, fileName) {
      document.getElementById('diseaseResult').textContent = disease;
      document.getElementById('confidenceFill').style.width = confidence + '%';
      document.getElementById('confidenceFill').textContent = confidence + '%';

      const diseaseKey = disease.toLowerCase().replace(/\s*\/\s*/g, '_').replace(/\s+/g, '_');
      const care = careDatabase[diseaseKey] || careDatabase['normal'];

      document.getElementById('careList').innerHTML = care.map(item => `<li>${item}</li>`).join('');

      currentDetection = {
        id: Date.now().toString(),
        disease,
        confidence,
        fileName,
        timestamp: new Date().toISOString()
      };

      if (backendConnected) {
        const record = {
          id: currentDetection.id,
          image_name: fileName,
          disease_detected: disease,
          confidence_score: confidence,
          timestamp: currentDetection.timestamp
        };

        await saveRecordToBackend(record);
      } else {
        showBanner('ÔøΩÔøΩÔøΩÔ∏è Backend disconnected - record not saved', 'error');
      }

      document.getElementById('loading').classList.add('hidden');
      document.getElementById('results').classList.remove('hidden');
    }

    function showDoctorFinder() {
      document.getElementById('doctorFinder').classList.toggle('hidden');
    }

    function searchDoctor(specialty) {
      window.open(`https://www.google.com/search?q=${encodeURIComponent(specialty + ' near me')}`, '_blank', 'noopener,noreferrer');
    }

    function showShareModal() {
      document.getElementById('shareModal').classList.add('active');
    }

    function closeShareModal() {
      document.getElementById('shareModal').classList.remove('active');
    }

    function getReportText() {
      if (!currentDetection) return '';

      const care = careDatabase[currentDetection.disease.toLowerCase().replace(/\s*\/\s*/g, '_').replace(/\s+/g, '_')] || careDatabase['normal'];

      return `üè• VisionCare Pro - Eye Disease Detection Report

üìÖ Date: ${new Date(currentDetection.timestamp).toLocaleString()}
üìÅ Image: ${currentDetection.fileName}

üîç RESULTS:
Condition: ${currentDetection.disease}
Confidence: ${currentDetection.confidence}%

üí° CARE RECOMMENDATIONS:
${care.map((rec, i) => `${i + 1}. ${rec}`).join('\n')}

‚ö†Ô∏è Always consult a healthcare professional for proper diagnosis.`;
    }

    function shareWhatsApp() {
      const text = getReportText();
      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank', 'noopener,noreferrer');
      closeShareModal();
    }

    function shareEmail() {
      const text = getReportText();
      const subject = 'VisionCare Pro - Eye Disease Detection Report';
      window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(text)}`, '_blank', 'noopener,noreferrer');
      closeShareModal();
    }

    function copyReportText() {
      const text = getReportText();
      navigator.clipboard.writeText(text).then(() => {
        showBanner('‚úÖ Report copied to clipboard!', 'success');
        closeShareModal();
      });
    }

    function downloadReport() {
      if (!currentDetection) return;
      const report = getReportText();
      const blob = new Blob([report], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `VisionCare-Report-${Date.now()}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function exportHistoryPDF() {
      if (detectionHistory.length === 0) {
        showBanner('No history to export', 'error');
        return;
      }

      const sorted = [...detectionHistory].sort((a, b) =>
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      let report = `üè• VisionCare Pro - Complete Detection History
Generated: ${new Date().toLocaleString()}
Total Scans: ${sorted.length}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

`;

      sorted.forEach((item, index) => {
        const date = new Date(item.timestamp);
        report += `
SCAN #${index + 1}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩÔøΩÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìÖ Date: ${date.toLocaleString()}
üìÅ Image: ${item.image_name}
üîç Condition: ${item.disease_detected}
üìä Confidence: ${item.confidence_score}%

`;
      });

      report += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö†Ô∏è Always consult a healthcare professional
Generated by VisionCare Pro`;

      const blob = new Blob([report], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `VisionCare-History-${Date.now()}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function newScan() {
      document.getElementById('previewCard').classList.add('hidden');
      document.getElementById('results').classList.add('hidden');
      document.getElementById('doctorFinder').classList.add('hidden');
      document.getElementById('fileInput').value = '';
      currentDetection = null;
    }

    function renderHistory() {
      if (detectionHistory.length === 0) {
        document.getElementById('historyCard').classList.add('hidden');
        return;
      }

      document.getElementById('historyCard').classList.remove('hidden');

      const sorted = [...detectionHistory].sort((a, b) =>
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      document.getElementById('historyList').innerHTML = sorted.map(item => {
        const date = new Date(item.timestamp);
        const formatted = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();

        return `
          <div class="history-item">
            <div>
              <div class="history-disease">${item.disease_detected}</div>
              <div class="history-meta">${item.image_name} ‚Ä¢ ${formatted}</div>
            </div>
            <div class="history-score">${item.confidence_score}%</div>
          </div>
        `;
      }).join('');
    }

    // ====== ADMIN DASHBOARD ======
    function updateAdminDashboard(data) {
      console.log('updateAdminDashboard called with', data.length, 'records');
      updateAdminStats(data);
      updateAdminDiseaseChart(data);
      adminFilteredRecords = [...data];
      updateAdminTable(adminFilteredRecords);
    }

    function updateAdminStats(data) {
      console.log('Updating stats with', data.length, 'records');
      const totalScans = data.length;

      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayScans = data.filter(record => {
        const recordDate = new Date(record.timestamp);
        recordDate.setHours(0, 0, 0, 0);
        return recordDate.getTime() === today.getTime();
      }).length;

      const avgConfidence = totalScans > 0
        ? Math.round(data.reduce((sum, r) => sum + r.confidence_score, 0) / totalScans)
        : 0;

      const highRiskCases = data.filter(r =>
        highRiskDiseases.includes(r.disease_detected)
      ).length;

      document.getElementById('adminTotalScans').textContent = totalScans;
      document.getElementById('adminTodayScans').textContent = todayScans;
      document.getElementById('adminAvgConfidence').textContent = avgConfidence + '%';
      document.getElementById('adminHighRiskCases').textContent = highRiskCases;

      console.log('Stats updated:', { totalScans, todayScans, avgConfidence, highRiskCases });
    }

    function updateAdminDiseaseChart(data) {
      console.log('Updating chart with', data.length, 'records');

      const distribution = {};
      data.forEach(record => {
        const disease = record.disease_detected;
        distribution[disease] = (distribution[disease] || 0) + 1;
      });

      console.log('Disease distribution:', distribution);

      const canvas = document.getElementById('adminDiseaseChart');
      const ctx = canvas.getContext('2d');

      canvas.width = 400;
      canvas.height = 300;

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 10;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const total = data.length;
      if (total === 0) {
        ctx.fillStyle = '#cbd5e0';
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        ctx.fill();

        ctx.fillStyle = '#718096';
        ctx.font = '16px Segoe UI';
        ctx.textAlign = 'center';
        ctx.fillText('No Data', centerX, centerY);
        return;
      }

      let currentAngle = -Math.PI / 2;

      Object.entries(distribution).forEach(([disease, count]) => {
        const sliceAngle = (count / total) * 2 * Math.PI;

        ctx.fillStyle = diseaseColors[disease] || '#cbd5e0';
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fill();

        ctx.strokeStyle = 'white';
        ctx.lineWidth = 3;
        ctx.stroke();

        currentAngle += sliceAngle;
      });

      const legendHTML = Object.entries(distribution)
        .map(([disease, count]) => {
          const percentage = ((count / total) * 100).toFixed(1);
          return `
            <div class="legend-item">
              <div class="legend-color" style="background: ${diseaseColors[disease] || '#cbd5e0'}"></div>
              <span class="legend-text">${disease}</span>
              <span class="legend-value">${percentage}%</span>
            </div>
          `;
        })
        .join('');

      document.getElementById('adminDiseaseLegend').innerHTML = legendHTML;
    }

    function updateAdminTable(records) {
      console.log('Updating table with', records.length, 'records');

      if (records.length === 0) {
        document.getElementById('adminTableBody').innerHTML = `
          <tr><td colspan="5" class="no-data">No records found</td></tr>
        `;
        return;
      }

      const sorted = [...records].sort((a, b) =>
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      const tableHTML = sorted.map(record => {
        const date = new Date(record.timestamp);
        const dateStr = date.toLocaleString();

        const diseaseClass = `disease-${record.disease_detected.toLowerCase().replace(/\s+/g, '-')}`;

        let confidenceClass = 'confidence-high';
        if (record.confidence_score < 70) confidenceClass = 'confidence-low';
        else if (record.confidence_score < 85) confidenceClass = 'confidence-medium';

        return `
          <tr>
            <td>${dateStr}</td>
            <td>${record.image_name}</td>
            <td><span class="disease-badge ${diseaseClass}">${record.disease_detected}</span></td>
            <td><span class="confidence-badge ${confidenceClass}">${record.confidence_score}%</span></td>
            <td>
              <button class="delete-btn" onclick="showDeleteModal('${record.id}')">
                üóëÔ∏è Delete
              </button>
            </td>
          </tr>
        `;
      }).join('');

      document.getElementById('adminTableBody').innerHTML = tableHTML;
      console.log('Table updated successfully');
    }

    function adminFilterTable() {
      const searchTerm = document.getElementById('adminSearchInput').value.toLowerCase();
      const diseaseFilter = document.getElementById('adminDiseaseFilter').value;

      adminFilteredRecords = detectionHistory.filter(record => {
        const matchesSearch =
          record.image_name.toLowerCase().includes(searchTerm) ||
          record.disease_detected.toLowerCase().includes(searchTerm);

        const matchesDisease =
          diseaseFilter === 'all' ||
          record.disease_detected === diseaseFilter;

        return matchesSearch && matchesDisease;
      });

      updateAdminTable(adminFilteredRecords);
    }

    function showDeleteModal(recordId) {
      recordToDelete = detectionHistory.find(r => r.id === recordId);
      document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
      recordToDelete = null;
    }

    async function confirmDelete() {
      if (!recordToDelete) {
        closeDeleteModal();
        return;
      }

      if (backendConnected) {
        await deleteRecordFromBackend(recordToDelete.id);
      } else {
        showBanner('Backend not connected', 'error');
      }

      closeDeleteModal();
    }

    function adminExportAllData() {
      if (detectionHistory.length === 0) {
        showBanner('No data to export', 'error');
        return;
      }

      const csvHeader = 'Date,Time,Image Name,Disease Detected,Confidence Score\n';
      const csvRows = detectionHistory.map(record => {
        const date = new Date(record.timestamp);
        return `${date.toLocaleDateString()},${date.toLocaleTimeString()},"${record.image_name}",${record.disease_detected},${record.confidence_score}%`;
      }).join('\n');

      const csv = csvHeader + csvRows;
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `VisionCare-Admin-Export-${Date.now()}.csv`;
      a.click();
      URL.revokeObjectURL(url);

      showBanner('‚úÖ Data exported successfully', 'success');
    }

    async function onConfigChange(config) {
      document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, ${config.background_color || defaultConfig.background_color}dd 100%)`;

      document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
      document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
      document.getElementById('disclaimerText').textContent = config.disclaimer_text || defaultConfig.disclaimer_text;
    }

    async function initializeApp() {
      console.log('üöÄ VisionCare Pro Starting...');
      console.log('üì° Backend URL:', BACKEND_CONFIG.API_URL);

      await checkBackendConnection();

      setInterval(checkBackendConnection, 30000);

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  window.elementSdk.config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  window.elementSdk.config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  window.elementSdk.config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  window.elementSdk.config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  window.elementSdk.config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                window.elementSdk.config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                window.elementSdk.config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['main_title', config.main_title || defaultConfig.main_title],
            ['subtitle', config.subtitle || defaultConfig.subtitle],
            ['disclaimer_text', config.disclaimer_text || defaultConfig.disclaimer_text]
          ])
        });
      }

      console.log('‚úÖ VisionCare Pro Ready');
      console.log('üîê Admin Password: admin123');
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
  <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9aa365c714b16eef',t:'MTc2NTEwMzk1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>